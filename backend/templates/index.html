<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <title>Luma Code</title>
    <link rel="stylesheet" href="/static/styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
</head>

<body>

    <div id="status-bar">
        <div class="status-left">
            <span id="status-file-title">untitled</span>
            <span id="status-cursor-position">1:1</span>
            <span id="status-file-language">plaintext</span>
        </div>
        <div class="status-right">
            <button id="snapshot-button"><svg width="12" height="12" fill="none" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9 2a3 3 0 0 0-3 3v14a3 3 0 0 0 3 3h6a3 3 0 0 0 3-3V5a3 3 0 0 0-3-3H9Zm-.5 4.75A.75.75 0 0 1 9.25 6h5.5a.75.75 0 0 1 0 1.5h-5.5a.75.75 0 0 1-.75-.75Zm0 11a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 0 1.5h-5.5a.75.75 0 0 1-.75-.75Zm0-3a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 0 1.5h-5.5a.75.75 0 0 1-.75-.75Z" fill="#fff"/></svg> Snapshots</button>
            <button id="pomodoro-button"><svg width="12" height="12" fill="none" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 5a8.5 8.5 0 1 1 0 17 8.5 8.5 0 0 1 0-17Zm0 3a.75.75 0 0 0-.743.648l-.007.102v4.5l.007.102a.75.75 0 0 0 1.486 0l.007-.102v-4.5l-.007-.102A.75.75 0 0 0 12 8Zm7.17-2.877.082.061 1.149 1a.75.75 0 0 1-.904 1.193l-.081-.061-1.149-1a.75.75 0 0 1 .903-1.193ZM14.25 2.5a.75.75 0 0 1 .102 1.493L14.25 4h-4.5a.75.75 0 0 1-.102-1.493L9.75 2.5h4.5Z" fill="#fff"/></svg> Pomodoro</button>
            <button id="mc-button"><svg width="12" height="12" fill="none" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3.5 12a8.5 8.5 0 0 1 17 0v2h-2.25a.75.75 0 0 0-.75.75v6.5c0 .414.336.75.75.75H19a3 3 0 0 0 3-3v-7c0-5.523-4.477-10-10-10S2 6.477 2 12v7a3 3 0 0 0 3 3h.75a.75.75 0 0 0 .75-.75v-6.5a.75.75 0 0 0-.75-.75H3.5v-2Zm9.25-.25a.75.75 0 0 0-1.5 0v10.5a.75.75 0 0 0 1.5 0v-10.5Zm-4 2.25a.75.75 0 0 1 .75.75v4.5a.75.75 0 0 1-1.5 0v-4.5a.75.75 0 0 1 .75-.75Zm7.25.75a.75.75 0 0 0-1.5 0v4.5a.75.75 0 0 0 1.5 0v-4.5Z" fill="#fff"/></svg> Music Connect</button>
        </div>
    </div>


    <div class="container">
        <div class="file-panel">
            <button id="open-folder-btn">Start Coding</button>
            <ul id="file-list" class="tree"></ul>
        </div>

        <div id="editor" style="width: 100%; height: 100%; border: none;flex: 6;"></div>

        <!-- OR ANY OTHER AMD LOADER HERE INSTEAD OF loader.js -->
        <script src="/node_modules/monaco-editor/min/vs/loader.js"></script>

        <script>
            let editor;  // Hacer que editor sea accesible globalmente

require.config({ paths: { vs: '/node_modules/monaco-editor/min/vs' } });

require(['vs/editor/editor.main'], function () {
    editor = monaco.editor.create(document.getElementById('editor'), { 
        theme: 'vs-dark',
        fontSize: 18,
        fontWeight: '500',
        lineHeight: 1.7,
    });

    window.addEventListener('resize', () => {
        editor.layout();
    });

    // Este evento no interfiere con el Enter
    document.addEventListener('keydown', (e) => {
        // Puedes agregar lógica adicional aquí si es necesario
    });

    editor.onDidChangeCursorPosition((e) => {
    const position = editor.getPosition();
    document.getElementById('status-cursor-position').textContent = `${position.lineNumber}:${position.column}`;
    });

    // Función para actualizar el lenguaje activo en la barra de estado
    function updateFileLanguage() {
        const model = editor.getModel(); // Obtener el modelo activo
        const language = model.getLanguageId(); // Obtener el lenguaje del modelo
        document.getElementById('status-file-language').textContent = language ? language : 'Plain Text';
    }

// Ahora puedes llamar a updateFileName aquí
editor.onDidChangeModelLanguage(() => {
    updateFileLanguage();
});

    // Al iniciar, obtener el lenguaje del archivo abierto
    updateFileLanguage();

});
        </script>

        <div class="chat">
            <div id="chat-log"></div>
            <div class="chat-input-wrapper">
                <textarea id="chat-input" placeholder="Type here to chat with Luma"></textarea>
                <div class="input-hint">
                    <span class="hint-enter">Enter</span> to send, <span class="hint-shift-enter">Shift + Enter</span>
                    for new line, <span class="hint-at">@</span> for internal commands.
                </div>

                <div id="command-suggestions" style="display: none;">
                    <ul>
                        <li id="clean-command">@clean - Clean Luma's memory</li>
                    </ul>
                </div>


            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>

    <script src="static/index.js"></script>

<div id="snapshot-panel">
        <h3>Luma Snapshots</h3>
        <p>Create snapshots to never lose progress on your code, allowing you to easily navigate between previous versions of your work.</p>
<button id="backup-directory-button">Create Snapshot</button>
<br>
<p>Creating a snapshot can take a long time depending on the size of your project. However, you can press <code class="inline-code">ESC</code> to close this window, and the process will continue to work in the background while the snapshot is being created.</p>
        <br>
        <h4>Snapshots:</h4>
        <ul id="snapshot-list"></ul>
    </div>

<div id="pomodoro-panel">
    <h3>Luma Pomodoro</h3>
    <p>Welcome to Luma Pomodoro, your intelligent assistant for maximizing productivity and taking care of your eye health. Work for 20 minutes and enjoy brief breaks. Luma Code automatically detects when you start your work session, allowing you to focus on what really matters.</p>
    <p id="pomodoro-timer">Next break in: <strong>20:00</strong></p>
    <br>
    <p>Remember to apply the <strong>20-20-20</strong> rule: every 20 minutes, take a short break of 20 seconds and look at something 20 feet away to relax your eyes. Let Luma Code take care of the rest!</p>
</div>

<script type="text/javascript">
// Mostrar el panel de Snapshots
document.getElementById('snapshot-button').addEventListener('click', () => {
    const snapshotPanel = document.getElementById('snapshot-panel');
    
    // Mostrar el panel
    snapshotPanel.style.display = 'block';
});

// Selecciona el panel de snapshots
const snapshotPanel = document.getElementById('snapshot-panel');

// Escucha cuando se presiona una tecla en el documento
document.addEventListener('keydown', function(event) {
    // Si la tecla presionada es 'Esc' (Escape)
    if (event.key === 'Escape') {
        // Oculta el panel de snapshots
        snapshotPanel.style.display = 'none';
    }
});
</script>

<script type="text/javascript">
    let pomodoroTimer;
    let workDuration = 20 * 60; // 20 minutos en segundos
    let shortBreakDuration = 20; // 20 segundos
    let longBreakDuration = 10 * 60; // 10 minutos en segundos
    let cycles = 0; // Contador de ciclos
    let isPomodoroRunning = false; // Variable para rastrear si el Pomodoro está en ejecución

    function startPomodoro() {
        if (isPomodoroRunning) {
            return; // No iniciar de nuevo si ya está en ejecución
        }
        isPomodoroRunning = true; // Marcar que el Pomodoro ha comenzado
        cycles = 0;
        startWorkSession();
    }

    function startWorkSession() {
        clearInterval(pomodoroTimer);
        let timeLeft = workDuration;
        updatePomodoroTimer(timeLeft); // Actualizar el temporizador en el DOM

        pomodoroTimer = setInterval(() => {
            if (timeLeft <= 0) {
                clearInterval(pomodoroTimer);
                alert("Great job, you've finished your work session! It's time to take a short break and recharge");
                cycles++;
                isPomodoroRunning = false; // Marcar que el Pomodoro ha terminado
                if (cycles >= 4) {
                    startLongBreak(); // Después de 4 ciclos, tomar un descanso largo
                } else {
                    startShortBreak();
                }
            } else {
                timeLeft--;
                updatePomodoroTimer(timeLeft); // Actualizar el temporizador en el DOM
            }
        }, 1000);
    }

    function startShortBreak() {
        let timeLeft = shortBreakDuration;
        updatePomodoroTimer(timeLeft); // Actualizar el temporizador en el DOM

        pomodoroTimer = setInterval(() => {
            if (timeLeft <= 0) {
                clearInterval(pomodoroTimer);
                alert("Your short break is over! Time to get back to work and shine!");
                isPomodoroRunning = false; // Marcar que el Pomodoro ha terminado
                startWorkSession(); // Iniciar la siguiente sesión de trabajo
            } else {
                timeLeft--;
                updatePomodoroTimer(timeLeft); // Actualizar el temporizador en el DOM
            }
        }, 1000);
    }

    function startLongBreak() {
        let timeLeft = longBreakDuration;
        updatePomodoroTimer(timeLeft); // Actualizar el temporizador en el DOM

        pomodoroTimer = setInterval(() => {
            if (timeLeft <= 0) {
                clearInterval(pomodoroTimer);
                alert("Your long break is up! Let’s dive back into work and make great things happen!");
                isPomodoroRunning = false; // Marcar que el Pomodoro ha terminado
                startWorkSession(); // Iniciar la siguiente sesión de trabajo
            } else {
                timeLeft--;
                updatePomodoroTimer(timeLeft); // Actualizar el temporizador en el DOM
            }
        }, 1000);
    }

    // Función para actualizar el temporizador en el DOM
    function updatePomodoroTimer(seconds) {
        const minutes = Math.floor(seconds / 60);
        const remainingSeconds = seconds % 60;
        const timerElement = document.getElementById('pomodoro-timer');
        timerElement.textContent = `Next break in: ${minutes}:${remainingSeconds < 10 ? '0' : ''}${remainingSeconds}`;
    }

    // Agregar evento al botón Pomodoro
    document.getElementById('pomodoro-button').addEventListener('click', () => {
        startPomodoro();
    });
</script>

<script>
// Mostrar el panel de Snapshots
document.getElementById('pomodoro-button').addEventListener('click', () => {
    const pomodoroPanel = document.getElementById('pomodoro-panel');
    
    // Mostrar el panel
    pomodoroPanel.style.display = 'block';
});

// Selecciona el panel de snapshots
const pomodoroPanel = document.getElementById('pomodoro-panel');

// Escucha cuando se presiona una tecla en el documento
document.addEventListener('keydown', function(event) {
    // Si la tecla presionada es 'Esc' (Escape)
    if (event.key === 'Escape') {
        // Oculta el panel de snapshots
        pomodoroPanel.style.display = 'none';
    }
});

</script>
</body>

</html>